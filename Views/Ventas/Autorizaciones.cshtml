@model IEnumerable<Javo2.ViewModels.Operaciones.Ventas.VentaListViewModel>

    @{
    ViewBag.Title = "Ventas Pendientes de Autorización";
    Layout = "~/Views/Shared/_Layout.cshtml";
    }

    <h2 class="mb-4">@ViewBag.Title</h2>

    <!-- Resumen de Autorizaciones -->
    <div class="summary-cards mb-4">
        <div class="summary-card">
            <h5>Total Pendientes</h5>
            <p>@Model.Count()</p>
        </div>
        <div class="summary-card">
            <h5>Monto Total</h5>
            <p>@Model.Sum(v => v.PrecioTotal).ToString("C")</p>
        </div>
    </div>

    <!-- Tabla de Ventas Pendientes -->
    <div class="card p-3">
        <div class="table-responsive">
            <table class="table table-dark table-striped align-middle">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Factura</th>
                        <th>Cliente</th>
                        <th>Total</th>
                        <th>Vendedor</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var venta in Model)
                {
                    <tr>
                        <td>@venta.FechaVenta.ToString("dd/MM/yyyy HH:mm")</td>
                        <td>@venta.NumeroFactura</td>
                        <td>@venta.NombreCliente</td>
                        <td>@venta.PrecioTotal.ToString("C")</td>
                        <td>@venta.Usuario</td>
                        <td>
                            <div class="btn-group">
                                <a asp-action="Details" asp-route-id="@venta.VentaID"
                                   class="btn btn-info btn-sm" title="Ver Detalles">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <button type="button" class="btn btn-success btn-sm autorizar-venta"
                                        data-id="@venta.VentaID" title="Autorizar">
                                    <i class="bi bi-check-circle"></i> Autorizar
                                </button>
                                <button type="button" class="btn btn-danger btn-sm rechazar-venta"
                                        data-id="@venta.VentaID" title="Rechazar">
                                    <i class="bi bi-x-circle"></i> Rechazar
                                </button>
                            </div>
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        </div>
    </div>

    @if (!Model.Any())
{
    <div class="alert alert-info mt-3">
        <i class="bi bi-info-circle me-2"></i>
        No hay ventas pendientes de autorización en este momento.
    </div>
}

    <div class="mt-3">
        <a asp-action="Index" class="btn btn-secondary">
            <i class="bi bi-arrow-left me-1"></i> Volver al Listado
        </a>
    </div>

    @section Scripts {
        <script>
        $(document).ready(function() {
            // Autorizar venta
            $('.autorizar-venta').click(function() {
                const ventaId = $(this).data('id');
                const $row = $(this).closest('tr');

                if (confirm('¿Está seguro que desea autorizar esta venta?')) {
                    $.ajax({
                        url: '@Url.Action("Autorizar", "Ventas")',
                        type: 'POST',
                        data: {
                            id: ventaId,
                            __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
                        },
                        success: function(response) {
                            if (response.success) {
                                $row.fadeOut(400, function() {
                                    $(this).remove();
                                    if ($('#ventasTable tbody tr').length === 0) {
                                        location.reload();
                                    }
                                });
                                toastr.success(response.message);
                            } else {
                                toastr.error(response.message || 'Error al autorizar la venta.');
                            }
                        },
                        error: function() {
                            toastr.error('Error al procesar la solicitud.');
                        }
                    });
                }
            });

            // Rechazar venta
            $('.rechazar-venta').click(function() {
                const ventaId = $(this).data('id');
                const $row = $(this).closest('tr');

                if (confirm('¿Está seguro que desea rechazar esta venta?')) {
                    $.ajax({
                        url: '@Url.Action("Rechazar", "Ventas")',
                        type: 'POST',
                        data: {
                            id: ventaId,
                            __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
                        },
                        success: function(response) {
                            if (response.success) {
                                $row.fadeOut(400, function() {
                                    $(this).remove();
                                    if ($('#ventasTable tbody tr').length === 0) {
                                        location.reload();
                                    }
                                });
                                toastr.success(response.message);
                            } else {
                                toastr.error(response.message || 'Error al rechazar la venta.');
                            }
                        },
                        error: function() {
                            toastr.error('Error al procesar la solicitud.');
                        }
                    });
                }
            });
        });
        </script>
    }
