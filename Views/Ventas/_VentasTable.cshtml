@using Javo2.ViewModels.Operaciones.Ventas
@model IEnumerable<VentaListViewModel>
@foreach (var venta in Model)
{
    <tr>
        <td>@venta.FechaVenta.ToString("dd/MM/yyyy")</td>
        <td>@venta.NumeroFactura</td>
        <td>@venta.NombreCliente</td>
        <td>@venta.PrecioTotal.ToString("C")</td>
        <td>
            @switch (venta.Estado)
            {
                case "Borrador":
                    <span class="badge bg-secondary">Borrador</span>
                    break;
                case "PendienteDeAutorizacion":
                    <span class="badge bg-warning text-dark">Pendiente Autorización</span>
                    break;
                case "Autorizada":
                    <span class="badge bg-success">Autorizada</span>
                    break;
                case "Rechazada":
                    <span class="badge bg-danger">Rechazada</span>
                    break;
                default:
                    <span class="badge bg-secondary">@venta.Estado</span>
                    break;
            }
        </td>
        <td>
            @if (venta.EstadoEntrega == "PendienteDeEntrega")
            {
                <span class="badge bg-info text-dark">Pendiente Entrega</span>
            }
            else
            {
                <span class="badge bg-success">Entregado</span>
            }
        </td>
        <td class="text-center">
            <div class="btn-group" role="group" aria-label="Acciones para venta @venta.VentaID">
                <a asp-action="Details" asp-route-id="@venta.VentaID" class="btn btn-sm btn-outline-info" title="Ver Detalles">
                    <i class="bi bi-eye" aria-hidden="true"></i>
                </a>
                @* Solo en borrador *@
                @if (venta.Estado == "Borrador")
                {
                    <a asp-action="Edit" asp-route-id="@venta.VentaID" class="btn btn-sm btn-outline-warning" title="Editar">
                        <i class="bi bi-pencil-square" aria-hidden="true"></i>
                    </a>
                }
                @* Aprobar/Rechazar *@
                @if (venta.Estado == "PendienteDeAutorizacion")
                {
                    <form asp-action="Aprobar" method="post" class="d-inline">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@venta.VentaID" />
                        <button type="submit" class="btn btn-sm btn-outline-success" title="Aprobar">
                            <i class="bi bi-check-circle" aria-hidden="true"></i>
                        </button>
                    </form>
                    <form asp-action="Rechazar" method="post" class="d-inline">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@venta.VentaID" />
                        <button type="submit" class="btn btn-sm btn-outline-danger" title="Rechazar">
                            <i class="bi bi-x-circle" aria-hidden="true"></i>
                        </button>
                    </form>
                }
                @* Reimprimir autorizada *@
                @if (venta.Estado == "Autorizada")
                {
                    <a asp-action="Reimprimir" asp-route-id="@venta.VentaID" class="btn btn-sm btn-outline-secondary" title="Reimprimir">
                        <i class="bi bi-printer" aria-hidden="true"></i>
                    </a>
                }
                @* Eliminar en borrador o rechazada *@
                @if (venta.Estado == "Borrador" || venta.Estado == "Rechazada")
                {
                    <form asp-action="Eliminar" method="post" class="d-inline" onsubmit="return confirm('¿Eliminar esta venta?');">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@venta.VentaID" />
                        <button type="submit" class="btn btn-sm btn-outline-danger" title="Eliminar">
                            <i class="bi bi-trash" aria-hidden="true"></i>
                        </button>
                    </form>
                }
            </div>
        </td>
    </tr>
}
