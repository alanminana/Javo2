@model Javo2.Models.Venta
@{
    ViewData["Title"] = "Detalle de Cotización";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="container-fluid py-3">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2 mb-0">Detalle de Cotización</h1>
        <div>
            <a asp-action="Index" class="btn btn-outline-secondary btn-sm me-2">
                <i class="bi bi-arrow-left me-1"></i>Volver
            </a>
            <a asp-action="Print" asp-route-id="@Model.VentaID" class="btn btn-secondary btn-sm me-2">
                <i class="bi bi-printer me-1"></i>Imprimir
            </a>
            <a asp-action="ConvertirAVenta" asp-route-id="@Model.VentaID" class="btn btn-success btn-sm">
                <i class="bi bi-cart-check me-1"></i>Convertir a Venta
            </a>
        </div>
    </div>

    <!-- Tarjeta de información principal -->
    <div class="card bg-dark text-light shadow-sm mb-4">
        <div class="card-header">
            <h5 class="mb-0">Información General</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <h6 class="text-muted">Número de Cotización</h6>
                        <p class="fs-5">@Model.NumeroFactura</p>
                    </div>
                    <div class="mb-3">
                        <h6 class="text-muted">Fecha de Emisión</h6>
                        <p>@Model.FechaVenta.ToString("dd/MM/yyyy HH:mm")</p>
                    </div>
                    <div class="mb-3">
                        <h6 class="text-muted">Vendedor</h6>
                        <p>@Model.Vendedor</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <h6 class="text-muted">Forma de Pago</h6>
                        <p>
                            @{
                                string formaPago = "No especificada";
                                switch (Model.FormaPagoID)
                                {
                                    case 1: formaPago = "Contado"; break;
                                    case 2: formaPago = "Tarjeta de Crédito"; break;
                                    case 3: formaPago = "Tarjeta de Débito"; break;
                                    case 4: formaPago = "Transferencia"; break;
                                    case 5: formaPago = "Pago Virtual"; break;
                                    case 6: formaPago = "Crédito Personal"; break;
                                }
                            }
                            @formaPago
                        </p>
                    </div>
                    <div class="mb-3">
                        <h6 class="text-muted">Total</h6>
                        <p class="fs-4 fw-bold text-success">@Model.PrecioTotal.ToString("C")</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Datos del cliente -->
    <div class="card bg-dark text-light shadow-sm mb-4">
        <div class="card-header">
            <h5 class="mb-0">Datos del Cliente</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <h6 class="text-muted">Nombre</h6>
                        <p class="fs-5">@Model.NombreCliente</p>
                    </div>
                    <div class="mb-3">
                        <h6 class="text-muted">Teléfono</h6>
                        <p>@Model.TelefonoCliente</p>
                    </div>
                    <div class="mb-3">
                        <h6 class="text-muted">Localidad</h6>
                        <p>@Model.LocalidadCliente</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <h6 class="text-muted">Domicilio</h6>
                        <p>@Model.DomicilioCliente</p>
                    </div>
                    <div class="mb-3">
                        <h6 class="text-muted">Celular</h6>
                        <p>@Model.CelularCliente</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Observaciones y condiciones -->
    <div class="card bg-dark text-light shadow-sm mb-4">
        <div class="card-header">
            <h5 class="mb-0">Observaciones y Condiciones</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <h6 class="text-muted">Observaciones</h6>
                        <p>@(string.IsNullOrEmpty(Model.Observaciones) ? "Sin observaciones" : Model.Observaciones)</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <h6 class="text-muted">Condiciones</h6>
                        <p>@(string.IsNullOrEmpty(Model.Condiciones) ? "Sin condiciones especiales" : Model.Condiciones)</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detalle de productos -->
    <div class="card bg-dark text-light shadow-sm">
        <div class="card-header">
            <h5 class="mb-0">Detalle de Productos</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-dark">
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Producto</th>
                            <th>Marca</th>
                            <th class="text-center">Cantidad</th>
                            <th class="text-end">Precio Unit.</th>
                            <th class="text-end">Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var detalle in Model.ProductosPresupuesto)
                        {
                            <tr>
                                <td>@(string.IsNullOrEmpty(detalle.CodigoAlfa) ? detalle.CodigoBarra : detalle.CodigoAlfa)</td>
                                <td>@detalle.NombreProducto</td>
                                <td>@detalle.Marca</td>
                                <td class="text-center">@detalle.Cantidad</td>
                                <td class="text-end">@detalle.PrecioUnitario.ToString("C")</td>
                                <td class="text-end">@(detalle.Cantidad * detalle.PrecioUnitario).ToString("C")</td>
                            </tr>
                        }
                    </tbody>
                    <tfoot>
                        <tr class="fw-bold">
                            <td colspan="3"></td>
                            <td class="text-center">@Model.TotalProductos</td>
                            <td class="text-end">Total:</td>
                            <td class="text-end">@Model.PrecioTotal.ToString("C")</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</section>