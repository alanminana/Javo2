@model CatalogoIndexViewModel
@{
    ViewBag.Title = "Catálogo";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 class="mb-4">@ViewBag.Title</h2>

<!-- Tarjetas de Resumen -->
<div class="summary-cards mb-4">
    <div class="summary-card">
        <h5>Total de Rubros</h5>
        <p>@Model.Rubros.Count()</p>
    </div>
    <div class="summary-card">
        <h5>Total de Marcas</h5>
        <p>@Model.Marcas.Count()</p>
    </div>
    <div class="summary-card">
        <h5>Total de SubRubros</h5>
        <p>@Model.Rubros.SelectMany(r => r.SubRubros).Count()</p>
    </div>
</div>

<!-- Formulario de Filtrado -->
<div class="card mb-4 p-4">
    <form id="filterForm" class="row g-3">
        <div class="col-md-3">
            <label for="filterField" class="form-label">Campo de Filtro</label>
            <select class="form-select" id="filterField">
                <option value="nombre">Nombre</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="filterValue" class="form-label">Valor</label>
            <input type="text" class="form-control" id="filterValue" placeholder="Ingrese valor del filtro" />
        </div>
        <div class="col-md-6 align-self-end">
            <button type="button" class="btn btn-primary me-2" id="applyFilter">
                <i class="bi bi-filter me-2"></i> Aplicar Filtro
            </button>
            <button type="button" class="btn btn-secondary" id="clearFilter">
                <i class="bi bi-x-circle me-2"></i> Limpiar Filtro
            </button>
        </div>
    </form>
</div>

<!-- Tablas de Datos -->
<div class="card p-3">
    <h3 class="card-title mb-3">Rubros y SubRubros</h3>
    <div class="table-responsive">
        <table class="table table-dark table-striped">
            <thead>
                <tr>
                    <th>Rubro</th>
                    <th>SubRubros</th>
                    <th>Total Stock</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="rubrosTableBody">
                @await Html.PartialAsync("_RubrosTable", Model.Rubros)
            </tbody>
        </table>
    </div>

    <hr class="my-4" />

    <h3 class="card-title mb-3">Marcas</h3>
    <div class="table-responsive">
        <table class="table table-dark table-striped">
            <thead>
                <tr>
                    <th>Marca</th>
                    <th>Total Stock</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="marcasTableBody">
                @await Html.PartialAsync("_MarcasTable", Model.Marcas)
            </tbody>
        </table>
    </div>
</div>

<!-- Botones para Agregar -->
<div class="mt-3">
    <a asp-action="CreateRubro" class="btn btn-success me-2">
        <i class="bi bi-plus-circle me-2"></i> Agregar Rubro
    </a>
    <a asp-action="CreateMarca" class="btn btn-success">
        <i class="bi bi-plus-circle me-2"></i> Agregar Marca
    </a>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#applyFilter').click(function () {
                var field = $('#filterField').val();
                var value = $('#filterValue').val();
                var filters = { Nombre: value };

                $.ajax({
                    url: '@Url.Action("FilterAsync", "Catalogo")',
                    type: 'GET',
                    data: filters,
                    success: function (data) {
                        $('#rubrosTableBody').html(data.rubrosPartial);
                        $('#marcasTableBody').html(data.marcasPartial);
                    },
                    error: function () {
                        alert("Error al aplicar los filtros.");
                    }
                });
            });

            $('#clearFilter').click(function () {
                $('#filterValue').val('');
                $('#applyFilter').click();
            });
        });
    </script>
}