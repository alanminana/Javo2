<!-- Views/Proveedores/DetallesCompra.cshtml -->
@model Javo2.ViewModels.Operaciones.Proveedores.CompraProveedorViewModel
@{
    ViewBag.Title = "Detalles de Compra";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="container-fluid py-3">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2 mb-0">@ViewBag.Title</h1>
        <div>
            <a asp-action="Compras" class="btn btn-secondary">
                <i class="bi bi-arrow-left me-1"></i> Volver al Listado
            </a>
            @if (Model.Estado == "Pendiente")
            {
                <form asp-action="ProcesarCompra" asp-route-id="@Model.CompraID" method="post" class="d-inline">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle me-1"></i> Procesar
                    </button>
                </form>
            }
            else if (Model.Estado == "Procesada")
            {
                <form asp-action="CompletarCompra" asp-route-id="@Model.CompraID" method="post" class="d-inline">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-check-circle-fill me-1"></i> Completar
                    </button>
                </form>
            }
            @if (Model.Estado != "Cancelada" && Model.Estado != "Completada")
            {
                <form asp-action="CancelarCompra" asp-route-id="@Model.CompraID" method="post" class="d-inline">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-x-circle me-1"></i> Cancelar
                    </button>
                </form>
            }
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-dark text-light">
                    <h2 class="h5 mb-0">Información de la Compra</h2>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-4">Número de Factura</dt>
                        <dd class="col-sm-8">@Model.NumeroFactura</dd>

                        <dt class="col-sm-4">Fecha</dt>
                        <dd class="col-sm-8">@Model.FechaCompra.ToString("dd/MM/yyyy HH:mm")</dd>

                        <dt class="col-sm-4">Proveedor</dt>
                        <dd class="col-sm-8">@Model.NombreProveedor</dd>

                        <dt class="col-sm-4">Total</dt>
                        <dd class="col-sm-8">@Model.PrecioTotal.ToString("C")</dd>

                        <dt class="col-sm-4">Estado</dt>
                        <dd class="col-sm-8">
                            @switch (Model.Estado)
                            {
                                case "Pendiente":
                                    <span class="badge bg-warning">Pendiente</span>
                                    break;
                                case "Procesada":
                                    <span class="badge bg-info">Procesada</span>
                                    break;
                                case "Completada":
                                    <span class="badge bg-success">Completada</span>
                                    break;
                                case "Cancelada":
                                    <span class="badge bg-danger">Cancelada</span>
                                    break;
                            }
                        </dd>

                        <dt class="col-sm-4">Usuario</dt>
                        <dd class="col-sm-8">@Model.Usuario</dd>
                    </dl>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-dark text-light">
                    <h2 class="h5 mb-0">Información de Pago</h2>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-4">Forma de Pago</dt>
                        <dd class="col-sm-8">
                            @switch (Model.FormaPagoID)
                            {
                                case 1:
                                    <span>Contado</span>
                                    break;
                                case 2:
                                    <span>Tarjeta de Crédito</span>
                                    break;
                                case 3:
                                    <span>Tarjeta de Débito</span>
                                    break;
                                case 4:
                                    <span>Transferencia</span>
                                    break;
                                case 5:
                                    <span>Pago Virtual</span>
                                    break;
                                case 6:
                                    <span>Crédito Personal</span>
                                    break;
                                default:
                                    <span>No especificada</span>
                                    break;
                            }
                        </dd>

                        @if (Model.FormaPagoID == 2 || Model.FormaPagoID == 3)
                        {
                            <dt class="col-sm-4">Banco</dt>
                            <dd class="col-sm-8">@(Model.BancoID.HasValue ? Model.Bancos.FirstOrDefault(b => b.Value == Model.BancoID.Value.ToString())?.Text : "No especificado")</dd>
                        }

                        @if (Model.FormaPagoID == 2)
                        {
                            <dt class="col-sm-4">Tipo de Tarjeta</dt>
                            <dd class="col-sm-8">@(Model.TipoTarjeta ?? "No especificado")</dd>

                            <dt class="col-sm-4">Cuotas</dt>
                            <dd class="col-sm-8">@(Model.Cuotas.HasValue ? Model.Cuotas.Value.ToString() : "No especificado")</dd>
                        }

                        @if (Model.FormaPagoID == 5)
                        {
                            <dt class="col-sm-4">Entidad Electrónica</dt>
                            <dd class="col-sm-8">@(Model.EntidadElectronica ?? "No especificado")</dd>
                        }

                        @if (Model.MontoCheque.HasValue)
                        {
                            <dt class="col-sm-4">Monto del Cheque</dt>
                            <dd class="col-sm-8">@Model.MontoCheque.Value.ToString("C")</dd>

                            <dt class="col-sm-4">Número de Cheque</dt>
                            <dd class="col-sm-8">@(Model.NumeroCheque ?? "No especificado")</dd>
                        }

                        @if (Model.FechaVencimiento.HasValue)
                        {
                            <dt class="col-sm-4">Fecha de Vencimiento</dt>
                            <dd class="col-sm-8">@Model.FechaVencimiento.Value.ToString("dd/MM/yyyy")</dd>
                        }
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm mb-4">
        <div class="card-header bg-dark text-light">
            <h2 class="h5 mb-0">Productos</h2>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover table-dark mb-0">
                    <thead class="bg-secondary text-light">
                        <tr>
                            <th>Producto</th>
                            <th>Cantidad</th>
                            <th>Precio Unitario</th>
                            <th>Precio Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var detalle in Model.ProductosCompra)
                        {
                            <tr>
                                <td>@detalle.NombreProducto</td>
                                <td>@detalle.Cantidad</td>
                                <td>@detalle.PrecioUnitario.ToString("C")</td>
                                <td>@detalle.PrecioTotal.ToString("C")</td>
                            </tr>
                        }
                    </tbody>
                    <tfoot>
                        <tr class="fw-bold">
                            <td colspan="2">Total</td>
                            <td>@Model.TotalProductos productos</td>
                            <td>@Model.PrecioTotal.ToString("C")</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    @if (!string.IsNullOrEmpty(Model.Observaciones))
    {
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-dark text-light">
                <h2 class="h5 mb-0">Observaciones</h2>
            </div>
            <div class="card-body">
                <p class="mb-0">@Model.Observaciones</p>
            </div>
        </div>
    }
</section>